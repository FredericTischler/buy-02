<div class="product-list-container">
  <!-- Header avec recherche et dÃ©connexion -->
  <mat-toolbar color="primary" class="toolbar">
    <span class="title">ðŸ›’ Boutique E-Commerce</span>
    
    <span class="spacer"></span>
    
    <!-- Barre de recherche -->
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Rechercher un produit</mat-label>
      <input matInput [(ngModel)]="searchKeyword" (keyup.enter)="onSearch()" placeholder="Ex: Ordinateur">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <!-- Bouton Panier avec badge -->
    <button mat-icon-button class="cart-button" (click)="goToCart()">
      <mat-icon [matBadge]="cartCount" matBadgeColor="warn" [matBadgeHidden]="cartCount === 0">shopping_cart</mat-icon>
    </button>

    <!-- Bouton Profil -->
    <button mat-icon-button (click)="goToProfile()" matTooltip="Mon Profil">
      <mat-icon>account_circle</mat-icon>
    </button>

    <!-- Bouton dÃ©connexion -->
    <button mat-raised-button color="warn" (click)="logout()">
      <mat-icon>logout</mat-icon>
      DÃ©connexion
    </button>
  </mat-toolbar>

  <!-- Contenu principal -->
  <div class="content">
    <!-- Message de chargement -->
    @if (loading) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Chargement des produits...</p>
      </div>
    }

    <!-- Message d'erreur -->
    @if (errorMessage) {
      <div class="error-container">
        <mat-icon>error</mat-icon>
        <p>{{ errorMessage }}</p>
      </div>
    }

    <!-- Liste des produits -->
    @if (!loading && !errorMessage) {
      @if (products.length === 0) {
        <div class="empty-container">
          <mat-icon>inventory_2</mat-icon>
          <p>Aucun produit disponible pour le moment</p>
        </div>
      } @else {
        <!-- Filtres et Tri -->
        <div class="filters-section">
          <div class="filters-header">
            <button mat-stroked-button (click)="toggleFilters()">
              <mat-icon>filter_list</mat-icon>
              Filtres
              @if (hasActiveFilters()) {
                <span class="filter-badge">actifs</span>
              }
            </button>
            @if (hasActiveFilters()) {
              <button mat-button color="warn" (click)="clearFilters()">
                <mat-icon>clear</mat-icon>
                Effacer
              </button>
            }

            <span class="spacer"></span>

            <!-- Tri -->
            <mat-form-field appearance="outline" class="sort-field">
              <mat-label>Trier par</mat-label>
              <mat-select [(ngModel)]="sortBy">
                @for (option of sortOptions; track option.value) {
                  <mat-option [value]="option.value">{{ option.label }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>sort</mat-icon>
            </mat-form-field>

            <span class="products-count">{{ filteredProducts.length }} produit(s)</span>
          </div>

          @if (showFilters) {
            <mat-card class="filters-card">
              <mat-card-content>
                <div class="filters-grid">
                  <!-- Filtre catÃ©gorie -->
                  <mat-form-field appearance="outline">
                    <mat-label>CatÃ©gorie</mat-label>
                    <mat-select [(ngModel)]="selectedCategory">
                      <mat-option value="">Toutes les catÃ©gories</mat-option>
                      @for (category of categories; track category) {
                        <mat-option [value]="category">{{ category }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>

                  <!-- Filtre prix min -->
                  <mat-form-field appearance="outline">
                    <mat-label>Prix minimum (â‚¬)</mat-label>
                    <input matInput type="number" [(ngModel)]="minPrice" [min]="0" placeholder="0">
                  </mat-form-field>

                  <!-- Filtre prix max -->
                  <mat-form-field appearance="outline">
                    <mat-label>Prix maximum (â‚¬)</mat-label>
                    <input matInput type="number" [(ngModel)]="maxPrice" [min]="0" placeholder="1000">
                  </mat-form-field>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>

        @if (filteredProducts.length === 0) {
          <div class="empty-container">
            <mat-icon>search_off</mat-icon>
            <p>Aucun produit ne correspond aux filtres</p>
            <button mat-raised-button color="primary" (click)="clearFilters()">
              Effacer les filtres
            </button>
          </div>
        } @else {
          <div class="products-grid">
            @for (product of filteredProducts; track product.id) {
            <mat-card class="product-card">
              <!-- Image du produit -->
              @if (product.imageUrl) {
                <img mat-card-image [src]="product.imageUrl" [alt]="product.name" class="product-image">
              } @else {
                <div class="no-image">
                  <mat-icon>image</mat-icon>
                  <span>Pas d'image</span>
                </div>
              }
              
              <mat-card-header>
                <mat-card-title>{{ product.name }}</mat-card-title>
                <mat-card-subtitle>{{ product.category }}</mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <p class="description">{{ product.description }}</p>
                <div class="product-info">
                  <span class="price">{{ product.price | currency:'EUR' }}</span>
                  <span class="stock" [class.low-stock]="product.stock < 10">
                    Stock: {{ product.stock }}
                  </span>
                </div>
                <p class="seller">Vendeur: {{ product.sellerName }}</p>
              </mat-card-content>
              
              <mat-card-actions>
                <button mat-raised-button color="primary" (click)="addToCart(product)">
                  <mat-icon>shopping_cart</mat-icon>
                  Ajouter au panier
                </button>
                <button mat-button color="accent" (click)="viewDetails(product.id)">
                  <mat-icon>info</mat-icon>
                  DÃ©tails
                </button>
              </mat-card-actions>
            </mat-card>
          }
          </div>
        }
      }
    }
  </div>
</div>
